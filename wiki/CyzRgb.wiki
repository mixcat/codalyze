#summary CYZ_RGB: An alternative firmware for [http://thingm.com/products/blinkm BlinkM]

= CYZ_RGB: An alternative firmware for [http://thingm.com/products/blinkm BlinkM] =
== Version Alpha 2 - Feature complete ==

BlinkM is a Smart LED produced by [http://thingm.com ThingM]: 

   BlinkM is a “Smart LED”, a networkable and 
   programmable full-color RGB LED for hobbyists,
   industrial designers, prototypers, and experimenters.
    
Just connect it to an I2C bus and start sending commands like "show rgb color" or "fade to hsv value" and so on and so forth (it does much more; see the human-readable [http://thingm.com/fileadmin/thingm/downloads/BlinkM_datasheet.pdf data sheet]).

A bit of explanation: I liked the idea to do a few more things with the leds and decided to modify the firmware. The original firmware is actually closed source (due to legal issues) so I had to start writing a new one from scratch.

*The latest release implements all the features of the original firmware*. The firmware has been slightly tested at a functional level, but has no unit tests.

I usually write loads of tests, possibly _before_ the actual code; this time I was wandering in a completely new area and I knew most of the code was going to be higly disposable. Now that all hurdles have been surpassed, the refactoring stage will go hand-to-hand with writing a thorough test suite. Wish me good luck.

The new firmware has two interesting *additional features* in the works: the ability to act as a *master on the I2C bus (it works)* and *support for dallas 1-wire protocol (not yet)*, to leave one pin free for your creativity.

= Download =

If you decide to download and give it a try, you'll find slave.hex and master.hex: the first is the actual blinkm firmware replacement, the other is the experimental master. You can flash the files on two different blinkms, connect them the to the same i2c bus and watch they change color together.

[http://code.google.com/p/codalyze/source/browse/#svn/cyz_rgb/trunk Browse] the source code.

[http://codalyze.googlecode.com/files/cyz_rgb-alpha2-2008_09_07-binary.zip Download] the latest binary release (alpha2).

[http://codalyze.blogspot.com/feeds/posts/default Subscribe] to news feed to follow
developement.

Get the sources with svn: {{{svn checkout http://codalyze.googlecode.com/svn/cyz_rgb/trunk cyz_rgb}}}

= Install =

Use avrdude to flash the chip:
{{{
avrdude -pt45 -cavrispmkII -Pusb -b115200 -Uflash:w:slave.hex:a 
}}}


== Interested? I need help ==

I'd like to hear from you. If you have any patch to submit it will be welcome.

_Please not that my experience in C is very limited. And it approaches zero when it comes to microcontroller programming. So, if you are any good at it, please be patient and expect the worse... i'm a java programmer ;). When you stop feeling sick after reading the code, well, drop me a line_

== Implemented features ==

||command name||cmd char||cmd byte||# args||# ret vals||format||implemented||
||*Go to RGB Color Now*||n||0x6e||3||0||{‘n’,R,G,B}||*yes*||
||*Fade to RGB Color*||c||0x63||3||0||{‘c’,R,G,B}||*yes*||
||Fade to HSB Color||h||0x68||3||0||{‘h’,H,S,B}||yes||
||Fade to Random RGB Color||C||0x43||3||0||{‘C’,R,G,B}||yes||
||Fade to Random HSB Color||H||0x48||3||0||{‘H’,H,S,B}||yes||
||Play Light Script||p||0x70||3||0||{‘p’,n,r,p}||yes||
||Stop Script||o||0x6f||0||0||{‘o’}||yes||
||Set Fade Speed||f||0x66||1||0||{‘f’,f}||yes||
||Set Time Adjust||t||0x74||1||0||{‘t’,t}||yes||
||Get Current RGB Color||g||0x67||0||3||{‘g’}||yes||
||Write Script Line||W||0x57||7||0||{‘W’,n,p,d,c,a1,a2,a3}||yes^2^||
||Read Script Line||R||0x52||2||5||{‘R’,n,p}||yes^1^||
||Set Script Length & Repeats||L||0x4c||3||0||{‘L’,n,l,r}||yes||
||Set BlinkM Address||A||0x41||4||0||{‘A’,a...}||yes||
||Get BlinkM Address||a||0x61||0||1||{‘a’}||yes||
||Get BlinkM Firmware Version||Z||0x5a||0||1||{‘z’}||yes^4^|| 
||Set Startup Parameters||B||0x42||5||0||{‘B’,m,n,r,f,t}||yes||
||Pre-deﬁned light scripts||||||||||||yes ^5^||

^x^ Only available in subversion head.

^2^ Max 10 lines. Only valid commands are go and fade to RGB. Script number 'n' is ignored, can only write script 0

^4^ current head version returns 0.1

^5^ only script 1. no predenfined script 0.

== Goals for next release ==

  * Write a comprehensive test suite
  * Decouple cyz_cmd from cyz_rgb
  * Decouple usiTwiSlave from cyz_cmd
  * Reduce binary footprint (now 4072b of 4096 available)
  * Add ability to write 2 scripts

Matteo Caprari <matteo.caprari gmail.com>